Grammar:

cmdline:
    assgn
    arglist

assgn:
    lvalue '=' word

lvalue:
    name
    name indexexpr

name:
    namstart
    namstart namend

namstart:
    '[^-~<>=!"|&+*/%{}() [:cntrl:][:digit:]]'

namend:
    namchar
    namchar namend

namchar:
    '[^-~<>=!"|&+*/%{}() [:cntrl:]]'

indexexpr:
    '[' word ']'

word:
    lvalue
    stringexpr
    block
    intexpr

stringexpr:
    formatstring
    formatstring ',' farglist

formatstring:
    '"' text '"'

text:
    textchar
    textchar text

textchar:
    '[^"\[:cntrl:]]'
    escseq
    formatseq

escseq:
    '\' escspec

escspec:
    '[N"\]'

formatseq:
    '%' formatspec

formatspec:
    '[%DCS]'

farglist:
    word
    word ',' farglist

block:
    '{' cmdlist '}

cmdlist:
    cmdlin
    cmdlin '\n' cmdlist

intexpr:
    logicexpr

logicexpr:
    eqexpr
    eqexpr logop logicexpr

eqexpr:
    addexpr
    addexpr eqop eqexpr

addexpr:
    mulexpr
    mulexpr addop addexpr

mulexpr:
    term
    term mulop mulexpr

term:
    block
    lvalue
    intterm
    parenterm

intterm:
    intchar
    intchar intterm

intchar:
    [[:digit:]]

parenterm:
    '(' intexpr ')

logop:
    [&|]

eqop:
    (==|!=|<|>|<=|>=)

addop:
    [+-]

mulop:
    [*/%]

arglist:
    word
    word space arglist

space:
    ' '
    ' ' space

